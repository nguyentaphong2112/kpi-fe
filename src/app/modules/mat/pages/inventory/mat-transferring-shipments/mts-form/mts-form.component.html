<div class='save-form-mat' [ngClass]="{'app-card' : isPage}">
  <div class="btn__across-no-page" *ngIf="isPage" style="margin-right: 20px">
    <hbt-button buttonType="NO_BORDER" *ngIf="mode !== modeConst.VIEW" (click)="save()" buttonAvailableStyle="SAVE"
                buttonText="{{'common.button.save' | translate}}" type='SUBMIT'></hbt-button>
    <hbt-button
      buttonAvailableStyle="DEFAULT"
      buttonText="{{ 'common.button.back' | translate }}"
      (click)="back()">
    </hbt-button>
  </div>
  <form nz-form [formGroup]="form" style="margin-top: 20px">
    <div nz-row [nzGutter]="[20,15]">

      <!--số phiếu nhập kho-->
      <div nz-col [nzXs]="12" [nzLg]="12">
        <hbt-input-text formControlName="pickingNo" maxLength="50" [disable]="true"
                        [type]="isSubmitted && form.controls['pickingNo'].errors ? 'error' : 'default'"
                        [showError]="isSubmitted && form.controls['pickingNo'].errors != null"
                        [errors]="form.controls['pickingNo'].errors"
                        [errorDefs]="[{ errorName: 'required', errorDescription: 'common.validate.required' | translate: {'param': 'mat.matTransferringShipments.table.pickingNo' | translate }},
                        { errorName: 'maxlength', errorDescription: 'common.validate.maxLength' | translate: {'numberLength': 50}}]"
                        placeholderText="{{'mat.matTransferringShipments.table.pickingNo' | translate}}"
                        labelText="{{'mat.matTransferringShipments.table.pickingNo' | translate}} <span class='label__required'>*</span>"
        ></hbt-input-text>
      </div>

      <!--ngày chuyển-->
      <div nz-col [nzXs]="12" [nzLg]="12">
        <hbt-date-picker
          [type]="isSubmitted && form.controls['transferringDate'].errors ? 'error' : 'default'"
          [showError]="isSubmitted && form.controls['transferringDate'].errors != null"
          [errors]="form.controls['transferringDate'].errors"
          [errorDefs]="[{ errorName: 'required', errorDescription: 'common.validate.required' | translate: {'param': 'mat.matTransferringShipments.table.transferringDate' | translate }}]"
          placeholderText="{{'mat.matTransferringShipments.table.transferringDate' | translate}}"
          labelText="{{'mat.matTransferringShipments.table.transferringDate' | translate}} <span class='label__required'>*</span>"
          formControlName="transferringDate"></hbt-date-picker>
      </div>

      <!--Tên phiếu-->
      <div nz-col [nzXs]="12" [nzLg]="12">
        <hbt-input-text formControlName="name" maxLength="255"
                        [type]="isSubmitted && form.controls['name'].errors ? 'error' : 'default'"
                        [showError]="isSubmitted && form.controls['name'].errors != null"
                        [errors]="form.controls['name'].errors"
                        [errorDefs]="[{ errorName: 'required', errorDescription: 'common.validate.required' | translate: {'param': 'mat.matTransferringShipments.table.name' | translate }},
                        { errorName: 'maxlength', errorDescription: 'common.validate.maxLength' | translate: {'numberLength': 255}}]"
                        placeholderText="{{'mat.matTransferringShipments.table.name' | translate}}"
                        labelText="{{'mat.matTransferringShipments.table.name' | translate}} <span class='label__required'>*</span>"
        ></hbt-input-text>
      </div>

      <!--id người lập-->
      <div nz-col [nzXs]="12" [nzLg]="12">
        <employee-data-picker status='WORKING'
                              formControlName="createdEmployeeId"
                              [type]="isSubmitted && form.controls['createdEmployeeId'].errors ? 'error' : 'default'"
                              [showError]="isSubmitted && form.controls['createdEmployeeId'].errors != null"
                              [errors]="form.controls['createdEmployeeId'].errors"
                              [errorDefs]="[{ errorName: 'required', errorDescription: 'common.validate.required' | translate: {'param': 'mat.matTransferringShipments.table.createdEmployeeId' | translate }}]"
                              labelText="{{'mat.matTransferringShipments.table.createdEmployeeId' | translate}} <span class='label__required'>*</span>"
        >
        </employee-data-picker>
      </div>

      <!--id kho-->
      <div nz-col [nzXs]="12" [nzLg]="12">
        <hbt-select [dataSelects]="listWarehouse"
          keyValue="warehouseId"
          keyLabel="name"
          formControlName="warehouseId"
          [type]="isSubmitted && form.controls['warehouseId'].errors ? 'error' : 'default'"
          [showError]="isSubmitted && form.controls['warehouseId'].errors != null"
          [errors]="form.controls['warehouseId'].errors"
          [errorDefs]="[{ errorName: 'required', errorDescription: 'common.validate.required' | translate: {'param': 'mat.matTransferringShipments.table.warehouseId' | translate }}]"
          placeholder="{{'mat.matTransferringShipments.table.warehouseId' | translate}}"
          labelText="{{'mat.matTransferringShipments.table.warehouseId' | translate}} <span class='label__required'>*</span>"
        ></hbt-select>
      </div>

      <!--id kho nhận-->
      <div nz-col [nzXs]="12" [nzLg]="12">
        <hbt-select [dataSelects]="listWarehouseReceived"
          keyValue="warehouseId"
          keyLabel="name"
          formControlName="receivedWarehouseId"
          [type]="isSubmitted && form.controls['receivedWarehouseId'].errors ? 'error' : 'default'"
          [showError]="isSubmitted && form.controls['receivedWarehouseId'].errors != null"
          [errors]="form.controls['receivedWarehouseId'].errors"
          [errorDefs]="[{ errorName: 'required', errorDescription: 'common.validate.required' | translate: {'param': 'mat.matTransferringShipments.table.receivedWarehouseId' | translate }}]"
          placeholder="{{'mat.matTransferringShipments.table.receivedWarehouseId' | translate}}"
          labelText="{{'mat.matTransferringShipments.table.receivedWarehouseId' | translate}} <span class='label__required'>*</span>"
        ></hbt-select>
      </div>

      <!--id người điều chuyển-->
      <div nz-col [nzXs]="12" [nzLg]="12">
        <employee-data-picker status='WORKING'
                              formControlName="transferredEmployeeId"
                              [type]="isSubmitted && form.controls['transferredEmployeeId'].errors ? 'error' : 'default'"
                              [showError]="isSubmitted && form.controls['transferredEmployeeId'].errors != null"
                              [errors]="form.controls['transferredEmployeeId'].errors"
                              [errorDefs]="[{ errorName: 'required', errorDescription: 'common.validate.required' | translate: {'param': 'mat.matTransferringShipments.table.transferredEmployeeId' | translate }}]"
                              labelText="{{'mat.matTransferringShipments.table.transferredEmployeeId' | translate}} <span class='label__required'>*</span>"
        >
        </employee-data-picker>
      </div>

      <!--Người nhận-->
      <div nz-col [nzXs]="12" [nzLg]="12">
        <employee-data-picker status='WORKING'
                              formControlName="receivedEmployeeId"
                              [type]="isSubmitted && form.controls['receivedEmployeeId'].errors ? 'error' : 'default'"
                              [showError]="isSubmitted && form.controls['receivedEmployeeId'].errors != null"
                              [errors]="form.controls['receivedEmployeeId'].errors"
                              [errorDefs]="[{ errorName: 'required', errorDescription: 'common.validate.required' | translate: {'param': 'mat.matTransferringShipments.table.receivedEmployeeId' | translate }}]"
                              labelText="{{'mat.matTransferringShipments.table.receivedEmployeeId' | translate}} <span class='label__required'>*</span>"
        >
        </employee-data-picker>
      </div>

      <!--Ghi chú-->
      <div nz-col [nzXs]="24" [nzLg]="24">
        <hbt-input-text formControlName="note" isTextAre
                        maxLength="500"
                        placeholderText="{{'mat.matTransferringShipments.table.note' | translate}}"
                        labelText="{{'mat.matTransferringShipments.table.note' | translate}}"
        ></hbt-input-text>
      </div>

      <div nz-col [nzXs]='24' [nzLg]='24' class="input__group">
        <hbt-upload
          [disable]="mode === modeConst.VIEW"
          [(docIdsDelete)]="docIdsDelete"
          [typeFileAvailable]="['jpg', 'png', 'pdf', 'doc', 'docx']"
          [multiple]="true"
          labelText="{{'common.label.attachFile' | translate}}"
          [fileList]="f['files'].value"
          (fileListChange)="onFileListChange($event, 'files', true)"
          (docIdsDeleteChange)="removeFile($event, 'files')"
          [serviceName]='serviceName'
          [showError]="isSubmitted"
        ></hbt-upload>
      </div>

      <ng-container *ngIf="mode === modeConst.VIEW">
        <!--người phê duyệt-->
        <div nz-col [nzXs]="12" [nzLg]="12">
          <hbt-input-text formControlName="approvedName" maxLength="255"
                          [type]="isSubmitted && form.controls['approvedName'].errors ? 'error' : 'default'"
                          [showError]="isSubmitted && form.controls['approvedName'].errors != null"
                          [errors]="form.controls['approvedName'].errors"
                          [errorDefs]="[{ errorName: 'maxlength', errorDescription: 'common.validate.maxLength' | translate: {'numberLength': 255}}]"
                          placeholderText="{{'mat.matTransferringShipments.table.approvedName' | translate}}"
                          labelText="{{'mat.matTransferringShipments.table.approvedName' | translate}}"
          ></hbt-input-text>
        </div>

        <!--trạng thái-->
        <div nz-col [nzXs]="12" [nzLg]="12">
          <hbt-select [serviceName]="microService.ADMIN"
                      [urlLoadData]="getUrlCategory(categoryCode.MAT_STATUS)"
                      keyLabel="name"
                      formControlName="statusId"
                      [type]="isSubmitted && form.controls['statusId'].errors ? 'error' : 'default'"
                      [showError]="isSubmitted && form.controls['statusId'].errors != null"
                      [errors]="form.controls['statusId'].errors"
                      [errorDefs]="[{ errorName: 'required', errorDescription: 'common.validate.required' | translate: {'param': 'mat.matTransferringShipments.table.statusId' | translate }}]"
                      placeholder="{{'mat.matTransferringShipments.table.statusId' | translate}}"
                      labelText="{{'mat.matTransferringShipments.table.statusId' | translate}}"
          ></hbt-select>
        </div>

        <!--ngày phê duyệt-->
        <div nz-col [nzXs]="12" [nzLg]="12">
          <hbt-date-picker
            placeholderText="{{'mat.matTransferringShipments.table.approvedTime' | translate}}"
            labelText="{{'mat.matTransferringShipments.table.approvedTime' | translate}}"
            formControlName="approvedTime"></hbt-date-picker>
        </div>

        <!--Lý do từ chối-->
        <div nz-col [nzXs]="24" [nzLg]="24">
          <hbt-input-text formControlName="approvedNote" isTextAre
                          maxLength="500"
                          placeholderText="{{'mat.matTransferringShipments.table.approvedNote' | translate}}"
                          labelText="{{'mat.matTransferringShipments.table.approvedNote' | translate}}"
          ></hbt-input-text>
        </div>
      </ng-container>

      <div nz-col [nzXs]='12' [nzLg]='12' class="mts-title">
        {{'mat.matTransferringShipments.table.listEquipmentIds' | translate}}
      </div>
      <div nz-col [nzXs]='12' [nzLg]='4' *ngIf="mode !== modeConst.VIEW && form.controls['warehouseId'].value">
        <hbt-button buttonSize="LARGE"
                    class="staff__research__btn__search"
                    buttonText="{{'common.button.uploadFile' | translate}}"
                    [isDisable]="!form.controls['warehouseId'].value"
                    [buttonTextColor]="_variable.$purple_800" (click)="doImportData()"></hbt-button>
      </div>
      <div nz-col [nzXs]='12' [nzLg]='8' *ngIf="mode !== modeConst.VIEW">
        <hbt-data-picker
          [disable]="!form.controls['warehouseId'].value"
          formControlName="listEquipmentIds"
          keyLabel="name"
          keyValue="equipmentId"
          [style]="'width: 95%'"
          [urlLoadData]="urlLoadData"
          [serviceName]="serviceName"
          [formMode]="mode"
          [isMulti]="true"
          [isRequiredInputParam]="true"
          [inputParam]="{warehouseId: form.controls['warehouseId'].value}"
          labelSearch="{{'mat.matTransferringShipments.listEquipments.table.code' | translate}}"
          [tableSetting]="[{label: 'mat.matTransferringShipments.listEquipments.table.code' | translate, value: 'code'}, {label: 'mat.matTransferringShipments.listEquipments.table.name' | translate, value: 'name'}]"
          [type]="isSubmitted && form.controls['listEquipmentIds'].errors ? 'error' : 'default'"
          [showError]="isSubmitted && form.controls['listEquipmentIds'].errors != null"
          [errors]="form.controls['listEquipmentIds'].errors"
          [errorDefs]="[{ errorName: 'required', errorDescription: 'common.validate.required' | translate: {'param': 'mat.matTransferringShipments.table.listEquipmentIds' | translate }}]"
          placeholder="{{'mat.matTransferringShipments.table.listEquipmentIds' | translate}}"
          (selectedChange)="selectEquipments($event)"
        >
        </hbt-data-picker>
      </div>
      <div nz-col [nzXs]='24' [nzLg]='24'>
        <app-mts-equipment-list [isDisabled]="mode === modeConst.VIEW" (listEquipmentIdsChange)="listEquipmentIdsChange($event)"></app-mts-equipment-list>
      </div>
    </div>
  </form>
</div>

<hbt-import-file
  [isGetData]="true"
  (getData)="updateList($event)"
  [showContent]="isImportData"
  (onCloseModal)="doCloseImport()"
  [importApi]="importApi"
  [downLoadTemplateApi]="downLoadTemplateApi"
  [fileTemplateName]="fileTemplateName"
  [doDownloadFileByNameApi]="doDownloadFileByNameApi"
>
</hbt-import-file>