<form nz-form [formGroup]="form" class="courses-index">
  <div class="search__custom-common {{isShowAdvSearch ? 'add__mr__bt-10' : 'remove__mr__bt-40'}}">
    <div nz-row class="button__action-left">
      <hbt-button
        class="staff__research__btn__search"
        buttonSize="LARGE"
        style="margin-right: 20px"
        buttonAvailableStyle="ADD"
        buttonText="{{'common.button.add' | translate}}"
        *ngIf="objFunction?.create"
        (click)="openModal('ADD')"
      ></hbt-button>
      <hbt-button buttonSize="LARGE"
                  class="staff__research__btn__search"
                  buttonText="{{'crm.courses.label.importLesson' | translate}}"
                  *ngIf="objFunction?.import"
                  [buttonTextColor]="_variable.$purple_800" (click)="doImportData()"></hbt-button>
    </div>

    <div class="search__page-right">
      <hbt-select style="margin-top: 0"
                  formControlName="courseId"
                  [dataSelects]="listCourse"
                  keyLabel="name"
                  keyValue="courseId"
                  placeholder="{{'crm.courses.label.course' | translate}}"
      >
      </hbt-select>
      <hbt-input-text formControlName='keySearch'
                      [maxLength]='255'
                      placeholderText="{{'crm.courses.label.keySearch' | translate}}"></hbt-input-text>
      <hbt-button
        buttonIconType="AWESOME"
        [prefixIcon]="isShowAdvSearch ? 'fa fa-angle-double-up' : 'fa fa-angle-double-down'"
        buttonSize="VERY_LARGE"
        [buttonTextColor]="_variable.$neutral_100"
        [buttonBorderColor]="_variable.$purple_800"
        [buttonBgColor]="_variable.$purple_800"
        (click)="isShowAdvSearch = !isShowAdvSearch"
      >
      </hbt-button>
    </div>
  </div>
  <div *ngIf="isShowAdvSearch" class="content__item content__item--border bg__content--default">
    <div class="form-search">
      <div nz-row [nzGutter]='[20,15]'>
        <div nz-col [nzXs]='12' [nzLg]='6'>
          <hbt-select-check-able formControlName="traineeId"
                                 [urlLoadData]="urlLoadCustomer"
                                 [serviceName]="serviceName"
                                 keyValue="customerId"
                                 keyLabel="fullName"
                                 placeholder="{{'crm.courses.table.name' | translate}}"
                                 labelText="{{'crm.courses.table.name' | translate}}"
          >
          </hbt-select-check-able>
        </div>
        <div nz-col [nzXs]='12' [nzLg]='6'>
          <hbt-input-text formControlName="phoneNumber" [maxLength]="11"
                          appNumberInput
                          placeholderText="{{'crm.courses.table.phoneNumber' | translate}}"
                          labelText="{{'crm.courses.table.phoneNumber' | translate}}"
          ></hbt-input-text>
        </div>
        <div nz-col [nzXs]='12' [nzLg]='6'>
          <hbt-date-picker
            formControlName="date"
            placeholderText="{{'crm.courses.table.studyTime' | translate}}"
            labelText="{{'crm.courses.table.studyTime' | translate}} "
          ></hbt-date-picker>
        </div>
        <div nz-col [nzXs]='12' [nzLg]='6'>
          <hbt-select-check-able formControlName="instructorId"
                      [urlLoadData]="urlLoadUser"
                      [serviceName]="serviceName"
                      keyValue="userId"
                      keyLabel="fullName"
                      placeholder="{{'crm.courses.table.tutor' | translate}}"
                      labelText="{{'crm.courses.table.tutor' | translate}}"
          >
          </hbt-select-check-able>
        </div>
        <div nz-col [nzXs]="24" [nzLg]="24" style="text-align: center">
          <hbt-button
            class="staff__research__btn__search"
            buttonAvailableStyle="SEARCH"
            buttonText="{{'common.button.search' | translate}}"
            (click)="search()"
          ></hbt-button>
        </div>
      </div>
    </div>
  </div>
  <div class='search__content--group' [ngClass]="{'search__content--group-hidden-header': isShowAdvSearch}">
    <hbt-table-wrap>
      <hbt-table
        (changePageNum)="search($event)"
        [tableConfig]="tableConfig" [dataList]="tableData"></hbt-table>
    </hbt-table-wrap>
  </div>

  <ng-template #actionTmpl let-data="data">
    <btn-more-action [model]="[data]" [setting]="actionSchema">
    </btn-more-action>
  </ng-template>
</form>

<hbt-import-file [showContent]='isImportData'
                 (onCloseModal)='doCloseImport($event)'
                 [importApi]='importApi'
                 [formImport]="formImport"
                 [nzWidth]="nzWidth"
                 title="{{'crm.courses.label.importLesson' | translate}}"
                 [downLoadTemplateApi]="downLoadTemplateApi"
                 [fileTemplateName]="fileTemplateName"
                 [doDownloadFileByNameApi]='doDownloadFileByNameApi'
                 (isSubmittedImport)="changeSubmittedImport($event)">
  <div class="formImport" style="margin-bottom: 30px;">
    <form nz-form [formGroup]="formImport">
      <div nz-row [nzGutter]='[20,15]'>
        <div nz-col [nzXs]='24' [nzLg]='12'>
          <hbt-select formControlName="trainingProgramId"
                      [urlLoadData]="urlLoadData"
                      [serviceName]="serviceName"
                      keyValue="trainingProgramId"
                      keyLabel="title"
                      [type]="isSubmittedImport && formImport.controls['trainingProgramId'].errors ? 'error' : 'default'"
                      [showError]="isSubmittedImport && formImport.controls['trainingProgramId'].errors !== null"
                      [errors]="formImport.controls['trainingProgramId'].errors"
                      [errorDefs]="[{ errorName: 'required', errorDescription: 'common.validate.required' | translate: {'param': 'crm.courses.label.trainingProgramId' | translate }}]"
                      labelText="{{'crm.courses.label.trainingProgramId' | translate}} <span class='label__required'>*</span>"
                      placeholder="{{'crm.courses.label.trainingProgramId' | translate}}"
                      (ngModelChange)="trainingChange($event)"
          >
          </hbt-select>
        </div>
        <div nz-col [nzXs]='24' [nzLg]='12'>
          <hbt-select
            formControlName="courseId"
            [dataSelects]="listCourse2"
            keyLabel="name"
            keyValue="courseId"
            placeholder="{{'crm.courses.label.course' | translate}}"
            labelText="{{'crm.courses.label.course' | translate}} <span class='label__required'>*</span>"
            [type]="isSubmittedImport && formImport.controls['courseId'].errors ? 'error' : 'default'"
            [showError]="isSubmittedImport && formImport.controls['courseId'].errors !== null"
            [errors]="formImport.controls['courseId'].errors"
            [errorDefs]="[{ errorName: 'required', errorDescription: 'common.validate.required' | translate: {'param': 'crm.courses.label.course' | translate }}]"
            (ngModelChange)="courseChange($event)"
          >
          </hbt-select>
        </div>
        <div nz-col [nzXs]='24' [nzLg]='12'>
          <hbt-select
            formControlName="courseLessonId"
            [dataSelects]="listLesson"
            keyLabel="name"
            keyValue="courseLessonId"
            placeholder="{{'crm.courses.label.courseLesson' | translate}}"
            labelText="{{'crm.courses.label.courseLesson' | translate}} <span class='label__required'>*</span>"
            [type]="isSubmittedImport && formImport.controls['courseLessonId'].errors ? 'error' : 'default'"
            [showError]="isSubmittedImport && formImport.controls['courseLessonId'].errors !== null"
            [errors]="formImport.controls['courseLessonId'].errors"
            [errorDefs]="[{ errorName: 'required', errorDescription: 'common.validate.required' | translate: {'param': 'crm.courses.label.courseLesson' | translate }}]"
          >
          </hbt-select>
        </div>
      </div>
    </form>
  </div>
</hbt-import-file>

<ng-template #footerTmpl>
  <hbt-button
    buttonAvailableStyle="CANCEL"
    buttonText="{{ 'common.button.cancel' | translate }}"
    (click)="modalRef.destroy()">
  </hbt-button>
  <hbt-button
    buttonAvailableStyle="SAVE"
    buttonText="{{ 'common.button.saveS' | translate }}"
    (click)="modalRef.getContentComponent().save()">
  </hbt-button>
</ng-template>

<ng-template #footerTmpl2>
  <hbt-button
    buttonAvailableStyle="CANCEL"
    buttonText="{{ 'common.button.cancel' | translate }}"
    (click)="modalRef.destroy()">
  </hbt-button>
  <hbt-button
    buttonAvailableStyle="SAVE"
    buttonText="{{ 'common.button.uploadFile' | translate }}"
    (click)="modalRef.getContentComponent().doImportData()">
  </hbt-button>
</ng-template>

